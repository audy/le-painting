= js :literally
= css :literally

Create a new post!

%div{class: 'literally export', id: 'literally', style: 'width:100%;height:480px;border: solid 1px #000;'}
  %canvas{id: 'painting'}

%form{class: 'input'}
  %input{type: 'submit', :'data-action' => 'export-as-png', value: 'Export as PNG'}

:javascript
  function dataURLtoBlob(dataURL) {
      // Decode the dataURL    
      var binary = atob(dataURL.split(',')[1]);
      // Create 8-bit unsigned array
      var array = [];
      for (var i = 0; i < binary.length; i++) {
        array.push(binary.charCodeAt(i));
      }
      // Return our Blob object
      return new Blob([new Uint8Array(array)], {type: 'image/png'});
    }

:javascript
  $(document).ready(function() {
    $('.literally.export').literallycanvas({
      imageURLPrefix: "/images",
      onInit: function(lc) {
        $('[data-action=export-as-png]').click(function(e) {
          e.preventDefault();
          var dataURL = lc.canvasForExport().toDataURL("image/png;base64;");
          var file = dataURLtoBlob(dataURL);

          var fd = new FormData();

          fd.append("image", file);

          console.log(fd);

          $.ajax({
            url: "/post/new",
            type: "POST",
            data: fd,
            processData: false,
            contentType: false,
            success: function(data, textStatus) {
               if (data.redirect) { window.location.href = data.redirect; }
             }
           });
        });
      }
    });
  });
